<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>ironic inspector流程 | leetpy</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ironic inspector流程</h1><a id="logo" href="/.">leetpy</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/reading/"><i class="fa fa-book"> reading</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ironic inspector流程</h1><div class="post-meta">Mar 11, 2017<span> | </span><span class="category"><a href="/categories/openstack/">openstack</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h1 id="inspector流程"><a href="#inspector流程" class="headerlink" title="inspector流程"></a>inspector流程</h1><h2 id="ironic-处理阶段"><a href="#ironic-处理阶段" class="headerlink" title="ironic 处理阶段"></a>ironic 处理阶段</h2><p>首先我们通过ironic的api，将node节点状态设置为manage，然后再设置为inspect。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ironic/api/controllers/v1/node.py</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">provision</span><span class="params">()</span>:</span></div><div class="line">    ...</div><div class="line">    <span class="keyword">elif</span> target == ir_state.VERBS[<span class="string">'inspect'</span>]:</div><div class="line">        pecan.request.rpcapi.inspect_hardware()</div></pre></td></tr></table></figure>
<p>这里 provision是一个修改node状态的api，我们在request请求中，将target设置为inspect。接着会通过rpc调<code>inspect_hardware(rpc.node_uuid, topic=topic)</code>方法。最终会调用manager.py的<code>inspect_hardware</code>方法。</p>
<p>inspect的具体实现是跟driver有关的，在driver.inspect.inspect_hardware中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ironic/drivers/modules/inspector.py</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_start_inspection</span><span class="params">(node_uuid, context)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        _call_inspector(client.introspect, node_uuid, context)</div><div class="line">        ...</div><div class="line">        </div><div class="line"><span class="comment"># ironic_inspector_client/client.py</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">introspect</span><span class="params">(uuid, base_url=None, auth_token=None,</span></span></div><div class="line">               new_ipmi_password=None, new_ipmi_username=None,</div><div class="line">               api_version=DEFAULT_API_VERSION, session=None, **kwargs):</div><div class="line"></div><div class="line">    c = v1.ClientV1(api_version=api_version, auth_token=auth_token,</div><div class="line">                    inspector_url=base_url, session=session, **kwargs)</div><div class="line">    <span class="keyword">return</span> c.introspect(uuid, new_ipmi_username=new_ipmi_username,</div><div class="line">                        new_ipmi_password=new_ipmi_password)</div><div class="line"></div><div class="line"><span class="comment"># ironic_inspector_client/v1.py</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">introspect</span><span class="params">(self, uuid, new_ipmi_password=None, new_ipmi_username=None)</span>:</span></div><div class="line">    ...</div><div class="line">    params = &#123;<span class="string">'new_ipmi_username'</span>: new_ipmi_username,</div><div class="line">              <span class="string">'new_ipmi_password'</span>: new_ipmi_password&#125;</div><div class="line">    self.request(<span class="string">'post'</span>, <span class="string">'/introspection/%s'</span> % uuid, params=params)</div></pre></td></tr></table></figure>
<p>然后创建一个inspector的client，并调用intropect函数。这个最终会发送post请求到/v1/introspection/<uuid>，并传入参数新的ipmi信息（如果需要更新ipmi用户名或者密码）</uuid></p>
<h2 id="inspector处理阶段"><a href="#inspector处理阶段" class="headerlink" title="inspector处理阶段"></a>inspector处理阶段</h2><p>inspector的api是用flask实现的，这里我们根据url找到对应的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># main.py</span></div><div class="line"><span class="meta">@app.route('/v1/introspection/&lt;uuid&gt;')</span></div><div class="line"><span class="meta">@convert_exceptions</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">api_introspection</span><span class="params">(uuid)</span>:</span></div><div class="line">    ...</div><div class="line">    introspect.introspect(uuid,</div><div class="line">                          new_ipmi_credentials=new_ipmi_credentails,</div><div class="line">                          token=flask.request.headers.get(<span class="string">'X-Auth-Token'</span>))</div><div class="line">    <span class="keyword">return</span> <span class="string">''</span>, <span class="number">202</span></div></pre></td></tr></table></figure>
<p>再看看introspect的具体实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># introspect.py</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">introspect</span><span class="params">()</span>:</span></div><div class="line">    node_info = node_cache.add_node(node.uuid,</div><div class="line">                                    bmc_address=bmc_address,</div><div class="line">                                    ironic=ironic)</div><div class="line">    future = utils.executor().submit(_background_introspect, ironic, node_info)</div><div class="line">    ...</div></pre></td></tr></table></figure>
<p>introspect函数先是更新了ipmi信息，然后在inspector的node表里添加一条记录，另外在attributes表里添加bmc_address信息。最终后台调用_background_introspect做主机发现。</p>
<p>接着调用 _background_introspect_locked设置裸机从pxe启动，并重启裸机。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># introspect.py</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_background_introspect_locked</span><span class="params">(ironic, node_info)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        ironic.node.set_boot_device(node_info.uuid, <span class="string">'pxe'</span>,</div><div class="line">                                    persistent=<span class="keyword">False</span>)</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        ironic.node.set_power_state(node_info.uuid, <span class="string">'reboot'</span>)</div></pre></td></tr></table></figure>
<p>我们在已经配置好了裸机，并在<code>/tftpboot/pxelinux.cfg/default</code>设置了如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">default introspect                                                                                                                                           </div><div class="line">label introspect</div><div class="line">kernel ironic-agent.vmlinuz</div><div class="line">append initrd=ironic-agent.initramfs ipa-inspection-callback-url=http://192.168.2.40:5050/v1/continue ipa-inspection-collectors=default,logs systemd.journald.forward_to_console=no</div><div class="line"></div><div class="line">ipappend 3</div></pre></td></tr></table></figure>
<h2 id="ipa阶段"><a href="#ipa阶段" class="headerlink" title="ipa阶段"></a>ipa阶段</h2><p>裸机从小系统启动之后，会启动ironic-python-agent服务。该服务会收集裸机的硬件信息，并发送到<code>ipa-inspection-callback-url</code>指定的url。</p>
<p>这里ipa发送的post数据内容包括：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"boot_interface"</span>: <span class="string">"01-98-40-bb-81-37-5b"</span>,</div><div class="line">    <span class="attr">"ipmi_address"</span>: <span class="string">"10.43.200.161"</span>,</div><div class="line">    <span class="attr">"error"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"root_disk"</span>: &#123;</div><div class="line">        <span class="attr">"name"</span>: <span class="string">"/dev/sda"</span>,</div><div class="line">        <span class="attr">"model"</span>: <span class="string">"PERC H730 Mini"</span>,</div><div class="line">        <span class="attr">"hctl"</span>: <span class="string">"0:2:0:0"</span>,</div><div class="line">        <span class="attr">"wwn_with_extension"</span>: <span class="string">"0x61866da06bc6e7001f920081106a8012"</span>,</div><div class="line">        <span class="attr">"wwn"</span>: <span class="string">"0x61866da06bc6e700"</span>,</div><div class="line">        <span class="attr">"vendor"</span>: <span class="string">"DELL"</span>,</div><div class="line">        <span class="attr">"size"</span>: <span class="number">299439751168</span>,</div><div class="line">        <span class="attr">"rotational"</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">"wwn_vendor_extension"</span>: <span class="string">"0x1f920081106a8012"</span>,</div><div class="line">        <span class="attr">"serial"</span>: <span class="string">"61866da06bc6e7001f920081106a8012"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"inventory"</span>: &#123;</div><div class="line">        <span class="attr">"bmc_address"</span>: <span class="string">"10.43.200.161"</span>,</div><div class="line">        <span class="attr">"interfaces"</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">"name"</span>: <span class="string">"eno1"</span>,</div><div class="line">                <span class="attr">"vendor"</span>: <span class="string">"0x8086"</span>,</div><div class="line">                <span class="attr">"lldp"</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">"ipv4_address"</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">"mac_address"</span>: <span class="string">"98:40:bb:81:37:59"</span>,</div><div class="line">                <span class="attr">"has_carrier"</span>: <span class="literal">false</span>,</div><div class="line">                <span class="attr">"client_id"</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">"product"</span>: <span class="string">"0x10f8"</span></div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                <span class="attr">"name"</span>: <span class="string">"eno2"</span>,</div><div class="line">                <span class="attr">"vendor"</span>: <span class="string">"0x8086"</span>,</div><div class="line">                <span class="attr">"lldp"</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">"ipv4_address"</span>: <span class="string">"192.168.2.50"</span>,</div><div class="line">                <span class="attr">"mac_address"</span>: <span class="string">"98:40:bb:81:37:5b"</span>,</div><div class="line">                <span class="attr">"has_carrier"</span>: <span class="literal">true</span>,</div><div class="line">                <span class="attr">"client_id"</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">"product"</span>: <span class="string">"0x10f8"</span></div><div class="line">            &#125;</div><div class="line">        ],</div><div class="line">        <span class="attr">"cpu"</span>: &#123;</div><div class="line">            <span class="attr">"count"</span>: <span class="number">48</span>,</div><div class="line">            <span class="attr">"frequency"</span>: <span class="string">"3100.0000"</span>,</div><div class="line">            <span class="attr">"model_name"</span>: <span class="string">"Intel(R) Xeon(R) CPU E5-2670 v3 @ 2.30GHz"</span>,</div><div class="line">            <span class="attr">"flags"</span>: [</div><div class="line">                <span class="string">"acpi"</span>,</div><div class="line">                <span class="string">"pts"</span></div><div class="line">            ],</div><div class="line">            <span class="attr">"architecture"</span>: <span class="string">"x86_64"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"disks"</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">"name"</span>: <span class="string">"/dev/sda"</span>,</div><div class="line">                <span class="attr">"model"</span>: <span class="string">"PERC H730 Mini"</span>,</div><div class="line">                <span class="attr">"hctl"</span>: <span class="string">"0:2:0:0"</span>,</div><div class="line">                <span class="attr">"wwn_with_extension"</span>: <span class="string">"0x61866da06bc6e7001f920081106a8012"</span>,</div><div class="line">                <span class="attr">"wwn"</span>: <span class="string">"0x61866da06bc6e700"</span>,</div><div class="line">                <span class="attr">"vendor"</span>: <span class="string">"DELL"</span>,</div><div class="line">                <span class="attr">"size"</span>: <span class="number">299439751168</span>,</div><div class="line">                <span class="attr">"rotational"</span>: <span class="literal">true</span>,</div><div class="line">                <span class="attr">"wwn_vendor_extension"</span>: <span class="string">"0x1f920081106a8012"</span>,</div><div class="line">                <span class="attr">"serial"</span>: <span class="string">"61866da06bc6e7001f920081106a8012"</span></div><div class="line">            &#125;</div><div class="line">        ],</div><div class="line">        <span class="attr">"boot"</span>: &#123;</div><div class="line">            <span class="attr">"current_boot_mode"</span>: <span class="string">"bios"</span>,</div><div class="line">            <span class="attr">"pxe_interface"</span>: <span class="string">"01-98-40-bb-81-37-5b"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"system_vendor"</span>: &#123;</div><div class="line">            <span class="attr">"serial_number"</span>: <span class="string">"G032KG2"</span>,</div><div class="line">            <span class="attr">"product_name"</span>: <span class="string">"PowerEdge M630"</span>,</div><div class="line">            <span class="attr">"manufacturer"</span>: <span class="string">"Dell Inc."</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"memory"</span>: &#123;</div><div class="line">            <span class="attr">"physical_mb"</span>: <span class="number">131072</span>,</div><div class="line">            <span class="attr">"total"</span>: <span class="number">135082627072</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="inspector主机上报阶段"><a href="#inspector主机上报阶段" class="headerlink" title="inspector主机上报阶段"></a>inspector主机上报阶段</h2><p>先看看inspector怎么处理ipa上报的数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># main.py</span></div><div class="line"><span class="meta">@app.route('/v1/continue', methods=[post])</span></div><div class="line"><span class="meta">@convert_exceptions</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">api_continue</span><span class="params">()</span>:</span></div><div class="line">    data = flask.request.get_json(force=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">return</span> flask.jsonify(process.process(data))</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># process.py</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(introspection_data)</span>:</span></div><div class="line">    <span class="string">"""Process data from the ramdisk.</span></div><div class="line">    </div><div class="line">    This function heavily relies on the hooks to do the actual data processing.</div><div class="line">    """</div><div class="line">    hooks = plugins_base.processing_hooks_manager()</div><div class="line">    failures = []</div><div class="line">    <span class="keyword">for</span> hook_ext <span class="keyword">in</span> hooks:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            hook_ext.obj.before_processing(introspection_data)</div><div class="line">        <span class="keyword">except</span> utils.Error <span class="keyword">as</span> exc:</div><div class="line">            ...</div><div class="line">    <span class="comment"># 根据ipmi_address和macs获取inpsector node</span></div><div class="line">    node_info = _finde_node_info(introspection_data, failures)</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        node = node_info.node()</div><div class="line">        ...</div><div class="line">        </div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">return</span> _process_node(node, introspection_data, node_info)</div></pre></td></tr></table></figure>
<p>我们可以看到这里数据是交由process出来，而process函数又调用各种钩子来出来ipa数据。接着根据ipmi_address查找对应的inspector node，再根据获取到的uuid来得到ironic node，交由_process_node()函数处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># process.py</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_process_node</span><span class="params">(node, introspection_data, node_info)</span>:</span></div><div class="line">    ir_utils.check_provision_state(node)</div><div class="line">    node_info.create_ports(introspection_data.get(<span class="string">'macs'</span>) <span class="keyword">or</span> ())</div><div class="line">    _run_post_hooks(node_inof, introspection_data)</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> CONF.processing.store_data == <span class="string">'switf'</span>:</div><div class="line">        stored_data = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> introspection_data.items()</div><div class="line">                       <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> _STORAGE_EXCLUDE_KEYS&#125;</div><div class="line">        swift_object_name = switf.store.store_introspection_data(stored_data,</div><div class="line">                                                                 node_info.uuid)</div><div class="line">    ironic = ir_utils.get_client()</div><div class="line">    firewall.update_filters(ironic)</div><div class="line">    </div><div class="line">    node_info.invalidate_cache()</div><div class="line">    rules.apply(node_info, introspection_data)</div><div class="line">    ...</div><div class="line">    utils.executor().submit(_finish, ironic, node_info, introspection_data)</div><div class="line"></div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_finish</span><span class="params">(ironic, node_info, introspection_data)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        ironic.node.set_power_state(node_info.uuid, <span class="string">'off'</span>)</div><div class="line">    node_info.finished()</div></pre></td></tr></table></figure>
<p>我们可以看到，如果配置了<code>store_data=swift</code>，inspector会把ipa上报的数据存储到swift中。最后的 node_info.finished()是删除inspector数据库中已完成的数据。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/03/11/ironic-inspector流程/" data-id="cj1m66rzi000cxc1qgqnn79qq" class="article-share-link">分享到</a><div class="tags"><a href="/tags/ironic/">ironic</a></div><div class="post-nav"><a href="/2016/09/11/leetcode-002/" class="pre">leetcode Add Two Numbers</a><a href="/2017/03/11/mac下启动mysql/" class="next">mac mysql启动配置</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/openstack/">openstack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/ipa/" style="font-size: 15px;">ipa</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/ironic/" style="font-size: 15px;">ironic</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/packstack/" style="font-size: 15px;">packstack</a> <a href="/tags/openstack/" style="font-size: 15px;">openstack</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/I-O/" style="font-size: 15px;">I/O</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/reading/一个人的朝圣/">《一个人的朝圣》读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/docker常用命令/">docker常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/git命令/">git常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/hello-world/">Hexo使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/04/ironic镜像制作/">ipa镜像制作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/04/ironic调用流程/">ironic代码走读</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/04/collections使用/">python collections模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/02/packstack安装openstack/">packstack安装openstack</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/02/异步IO/">异步I/O</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/28/ironic常用链接/">ironic常用链接</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">leetpy.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>